import{x as ie,a as ne,r as n,b as ce,y as de,t as me,j as e,f as L,X as he,u as m}from"./index-CSY5YgiJ.js";import{u as ue,t as xe}from"./zod-d7-ns2YA.js";import{N as je}from"./Navbar-eeXt84en.js";import{C as B,a as M,b as P,c as T,B as j}from"./card-dyY2Qvrr.js";import{I as o}from"./input-bM4iH4pw.js";import{T as Q}from"./textarea-BOa-INnI.js";import{L as u}from"./label-Bz9P5vOH.js";import{F as pe,a as p,b as g,c as y,d as f,e as w,P as ge,f as ye}from"./progress-z9G0hppw.js";import{S as fe,a as we,b as ve,c as be,d as Z}from"./select-CjlLjNwJ.js";import{z as Se}from"./proxy-BCkhZuQv.js";import{P as Ce}from"./plus-35letP8-.js";import{o as Ne,s as z,e as Fe}from"./types-L2k3iFj2.js";import"./index-Q8Z8E6D0.js";import"./Combination-CrH4g3RK.js";const _e=Ne({title:z().min(3,"Title must be at least 3 characters"),description:z().optional(),tagline:z().optional(),showreel_type:Fe(["embed","upload"]).optional(),showreel_url:z().optional(),journey_content:z().optional()}),Ye=()=>{const{id:U}=ie(),v=ne(),[h,k]=n.useState(!1),[R,Le]=n.useState(0),[E,Y]=n.useState(""),[A,X]=n.useState(""),[x,ee]=n.useState(null),[b,I]=n.useState([]),[W,J]=n.useState(""),[c,S]=n.useState({twitter:"",linkedin:"",instagram:"",website:""}),[C,D]=n.useState({primary:"#ef4444",secondary:"#1a1a1a"}),a=ue({resolver:xe(_e),defaultValues:{title:"",description:"",tagline:"",showreel_type:"embed",showreel_url:"",journey_content:""}}),{data:N,isLoading:V}=ce(),{data:l,isLoading:se}=de(U),re=me(),K=N==null?void 0:N.user,q=V||se;if(n.useEffect(()=>{const s=!!localStorage.getItem("token");s&&!V&&!N?v("/auth"):s||v("/auth")},[V,N,v]),q)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-primary"})});n.useEffect(()=>{if(l){a.reset({title:l.title,description:l.description||"",tagline:l.tagline||"",showreel_type:l.showreel_type||"embed",showreel_url:l.showreel_url||"",journey_content:l.journey_content||""}),Y(l.logo_url||""),X(l.hero_media_url||"");const s=l.brand_colors;s&&typeof s=="object"&&D(s);const r=l.social_links;r&&typeof r=="object"&&S(r),I(l.awards||[])}},[l,a]);const ae=async s=>{var d;const r=(d=s.target.files)==null?void 0:d[0];if(!r)return;const t=50,F=t*1024*1024;if(r.size>F){m.error(`Logo image is too large. Maximum file size is ${t}MB. Current file: ${(r.size/(1024*1024)).toFixed(2)}MB`),s.target.value="";return}const i=new FileReader;i.onloadend=()=>{Y(i.result)},i.onerror=()=>{m.error("Failed to read logo image file")},i.readAsDataURL(r)},te=async s=>{var d;const r=(d=s.target.files)==null?void 0:d[0];if(!r)return;const t=50,F=t*1024*1024;if(r.size>F){m.error(`Hero image is too large. Maximum file size is ${t}MB. Current file: ${(r.size/(1024*1024)).toFixed(2)}MB`),s.target.value="";return}const i=new FileReader;i.onloadend=()=>{X(i.result)},i.onerror=()=>{m.error("Failed to read hero image file")},i.readAsDataURL(r)},le=s=>{var t;const r=(t=s.target.files)==null?void 0:t[0];r&&ee(r)},G=()=>{W.trim()&&(I([...b,W.trim()]),J(""))},oe=s=>{I(b.filter((r,t)=>t!==s))},$=async(s,r)=>{if(K){k(!0);try{let t=E||"",F=A||"",i=s.showreel_url;if(x&&s.showreel_type==="upload"){if(x.size>52428800){m.error(`Showreel video is too large. Maximum file size is 50MB. Current file: ${(x.size/(1024*1024)).toFixed(2)}MB`),k(!1);return}const _=new FileReader;try{i=await new Promise((H,O)=>{_.onloadend=()=>{_.result?H(_.result):O(new Error("Failed to read video file"))},_.onerror=()=>{O(new Error("Failed to read video file"))},_.readAsDataURL(x)})}catch(H){m.error(H.message||"Failed to convert video to base64"),k(!1);return}}const d={title:s.title,description:s.description,tagline:s.tagline,logo_url:t,hero_media_url:F,showreel_url:i,showreel_type:s.showreel_type,journey_content:s.journey_content,brand_colors:C,social_links:c,awards:b.length>0?b:null};r!==void 0&&(d.published=r),await re.mutateAsync({id:U,data:d}),m.success("Wall updated successfully!"),v(`/wall/${U}`)}catch(t){m.error(t.message||"Failed to update wall")}finally{k(!1)}}};return q?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(je,{user:K}),e.jsx("div",{className:"container mx-auto px-4 pt-24 pb-12",children:e.jsxs(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold red-glow-intense mb-2",children:"Edit Wall"}),e.jsx("p",{className:"text-muted-foreground",children:"Update your digital presence"})]}),e.jsx(pe,{...a,children:e.jsxs("form",{className:"space-y-6",children:[e.jsxs(B,{children:[e.jsx(M,{children:e.jsx(P,{children:"Basic Information"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsx(p,{control:a.control,name:"title",render:({field:s})=>e.jsxs(g,{children:[e.jsx(y,{children:"Wall Title *"}),e.jsx(f,{children:e.jsx(o,{placeholder:"Enter wall title",...s})}),e.jsx(w,{})]})}),e.jsx(p,{control:a.control,name:"description",render:({field:s})=>e.jsxs(g,{children:[e.jsx(y,{children:"Description"}),e.jsx(f,{children:e.jsx(Q,{placeholder:"Describe your wall...",rows:4,...s})}),e.jsx(w,{})]})}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"hero",children:"Hero Image"}),e.jsx(o,{id:"hero",name:"hero",type:"file",accept:"image/*",onChange:te,className:"mt-2"}),A&&e.jsx("img",{src:A,alt:"Hero preview",className:"mt-4 rounded-lg max-h-48 object-cover"})]})]})]}),e.jsxs(B,{children:[e.jsx(M,{children:e.jsx(P,{children:"Studio Identity"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"logo",children:"Logo"}),e.jsx(o,{id:"logo",name:"logo",type:"file",accept:"image/*",onChange:ae,className:"mt-2"}),E&&e.jsx("img",{src:E,alt:"Logo preview",className:"mt-4 h-24 w-auto object-contain"})]}),e.jsx(p,{control:a.control,name:"tagline",render:({field:s})=>e.jsxs(g,{children:[e.jsx(y,{children:"Tagline"}),e.jsx(f,{children:e.jsx(o,{placeholder:"Your studio's tagline",...s})}),e.jsx(w,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"primary-color",children:"Primary Color"}),e.jsx(o,{id:"primary-color",type:"color",value:C.primary,onChange:s=>D({...C,primary:s.target.value}),className:"h-10 mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"secondary-color",children:"Secondary Color"}),e.jsx(o,{id:"secondary-color",type:"color",value:C.secondary,onChange:s=>D({...C,secondary:s.target.value}),className:"h-10 mt-2"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Social Links"}),e.jsx(o,{placeholder:"Twitter URL",value:c.twitter,onChange:s=>S({...c,twitter:s.target.value})}),e.jsx(o,{placeholder:"LinkedIn URL",value:c.linkedin,onChange:s=>S({...c,linkedin:s.target.value})}),e.jsx(o,{placeholder:"Instagram URL",value:c.instagram,onChange:s=>S({...c,instagram:s.target.value})}),e.jsx(o,{placeholder:"Website URL",value:c.website,onChange:s=>S({...c,website:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Awards & Certifications"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{placeholder:"Add an award...",value:W,onChange:s=>J(s.target.value),onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),G())}),e.jsx(j,{type:"button",onClick:G,size:"sm",children:e.jsx(Ce,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-2",children:b.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-secondary rounded",children:[e.jsx("span",{className:"text-sm",children:s}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>oe(r),children:e.jsx(he,{className:"h-4 w-4"})})]},r))})]})]})]}),e.jsxs(B,{children:[e.jsx(M,{children:e.jsx(P,{children:"Main Showreel"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsx(p,{control:a.control,name:"showreel_type",render:({field:s})=>e.jsxs(g,{children:[e.jsx(y,{children:"Showreel Type"}),e.jsxs(fe,{onValueChange:s.onChange,value:s.value,children:[e.jsx(f,{children:e.jsx(we,{children:e.jsx(ve,{placeholder:"Select type"})})}),e.jsxs(be,{children:[e.jsx(Z,{value:"embed",children:"Embed URL (YouTube/Vimeo)"}),e.jsx(Z,{value:"upload",children:"Upload Video"})]})]}),e.jsx(w,{})]})}),a.watch("showreel_type")==="embed"&&e.jsx(p,{control:a.control,name:"showreel_url",render:({field:s})=>e.jsxs(g,{children:[e.jsx(y,{children:"Video URL"}),e.jsx(f,{children:e.jsx(o,{placeholder:"https://youtube.com/...",...s})}),e.jsx(w,{})]})}),a.watch("showreel_type")==="upload"&&e.jsxs("div",{children:[e.jsx(u,{htmlFor:"showreel",children:"Upload Video"}),e.jsx(o,{id:"showreel",type:"file",accept:"video/*",onChange:le,className:"mt-2"}),x&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Selected: ",x.name]}),R>0&&R<100&&e.jsx(ge,{value:R,className:"mt-2"})]})]})]}),e.jsxs(B,{children:[e.jsx(M,{children:e.jsx(P,{children:"Studio Journey"})}),e.jsx(T,{children:e.jsx(p,{control:a.control,name:"journey_content",render:({field:s})=>e.jsxs(g,{children:[e.jsx(y,{children:"Your Story "}),e.jsx(ye,{children:"Example (2020: Founded VFX Studios with a vision to revolutionize visual effects)"}),e.jsx(f,{children:e.jsx(Q,{placeholder:"Tell your studio's story, milestones, and journey...",rows:6,...s})}),e.jsx(w,{})]})})})]}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>v(`/wall/${U}`),disabled:h,children:"Cancel"}),e.jsx(j,{type:"button",variant:"outline",onClick:()=>a.handleSubmit(s=>$(s,!1))(),disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save as Draft"}),e.jsx(j,{type:"button",variant:"outline",onClick:()=>a.handleSubmit(s=>$(s,!0))(),disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Publishing..."]}):"Publish & Update"}),e.jsx(j,{type:"button",onClick:()=>a.handleSubmit(s=>$(s))(),disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):"Update Wall"})]})]})})]})})]})};export{Ye as default};
