import{J as ke,r as b,Q as xe,j as e,P as Q,R as de,V as Ce,W as Ne,Y as we,o as le,a as Se,Z as Fe,_ as Pe,b as Re,h as Ee,f as oe,u as z}from"./index-CSY5YgiJ.js";import{u as Ae,b as ce,t as Ie}from"./zod-d7-ns2YA.js";import{C as P,a as R,b as E,c as A,B as I}from"./card-dyY2Qvrr.js";import{I as p}from"./input-bM4iH4pw.js";import{T as H}from"./textarea-BOa-INnI.js";import{u as Me,C as Te,S as D,a as V,b as L,c as U,d as h}from"./select-CjlLjNwJ.js";import{L as i}from"./label-Bz9P5vOH.js";import{S as me}from"./separator-8_S8d0px.js";import{j as qe}from"./jobs-hMLXsdQf.js";import{P as he}from"./plus-35letP8-.js";import{T as ue}from"./trash-2-DWtXyLna.js";import"./index-Q8Z8E6D0.js";import"./Combination-CrH4g3RK.js";import"./types-L2k3iFj2.js";var O="Checkbox",[Be,ts]=ke(O),[De,Z]=Be(O);function Ve(n){const{__scopeCheckbox:j,checked:u,children:v,defaultChecked:m,disabled:a,form:g,name:_,onCheckedChange:t,required:y,value:N="on",internal_do_not_use_render:o}=n,[l,r]=we({prop:u,defaultProp:m??!1,onChange:t,caller:O}),[k,C]=b.useState(null),[w,c]=b.useState(null),f=b.useRef(!1),M=k?!!g||!!k.closest("form"):!0,T={checked:l,disabled:a,setChecked:r,control:k,setControl:C,name:_,form:g,value:N,hasConsumerStoppedPropagationRef:f,required:y,defaultChecked:S(m)?!1:m,isFormControl:M,bubbleInput:w,setBubbleInput:c};return e.jsx(De,{scope:j,...T,children:Le(o)?o(T):v})}var pe="CheckboxTrigger",je=b.forwardRef(({__scopeCheckbox:n,onKeyDown:j,onClick:u,...v},m)=>{const{control:a,value:g,disabled:_,checked:t,required:y,setControl:N,setChecked:o,hasConsumerStoppedPropagationRef:l,isFormControl:r,bubbleInput:k}=Z(pe,n),C=xe(m,N),w=b.useRef(t);return b.useEffect(()=>{const c=a==null?void 0:a.form;if(c){const f=()=>o(w.current);return c.addEventListener("reset",f),()=>c.removeEventListener("reset",f)}},[a,o]),e.jsx(Q.button,{type:"button",role:"checkbox","aria-checked":S(t)?"mixed":t,"aria-required":y,"data-state":_e(t),"data-disabled":_?"":void 0,disabled:_,value:g,...v,ref:C,onKeyDown:de(j,c=>{c.key==="Enter"&&c.preventDefault()}),onClick:de(u,c=>{o(f=>S(f)?!0:!f),k&&r&&(l.current=c.isPropagationStopped(),l.current||c.stopPropagation())})})});je.displayName=pe;var ee=b.forwardRef((n,j)=>{const{__scopeCheckbox:u,name:v,checked:m,defaultChecked:a,required:g,disabled:_,value:t,onCheckedChange:y,form:N,...o}=n;return e.jsx(Ve,{__scopeCheckbox:u,checked:m,defaultChecked:a,disabled:_,required:g,onCheckedChange:y,name:v,form:N,value:t,internal_do_not_use_render:({isFormControl:l})=>e.jsxs(e.Fragment,{children:[e.jsx(je,{...o,ref:j,__scopeCheckbox:u}),l&&e.jsx(ge,{__scopeCheckbox:u})]})})});ee.displayName=O;var fe="CheckboxIndicator",be=b.forwardRef((n,j)=>{const{__scopeCheckbox:u,forceMount:v,...m}=n,a=Z(fe,u);return e.jsx(Ce,{present:v||S(a.checked)||a.checked===!0,children:e.jsx(Q.span,{"data-state":_e(a.checked),"data-disabled":a.disabled?"":void 0,...m,ref:j,style:{pointerEvents:"none",...n.style}})})});be.displayName=fe;var ve="CheckboxBubbleInput",ge=b.forwardRef(({__scopeCheckbox:n,...j},u)=>{const{control:v,hasConsumerStoppedPropagationRef:m,checked:a,defaultChecked:g,required:_,disabled:t,name:y,value:N,form:o,bubbleInput:l,setBubbleInput:r}=Z(ve,n),k=xe(u,r),C=Me(a),w=Ne(v);b.useEffect(()=>{const f=l;if(!f)return;const M=window.HTMLInputElement.prototype,X=Object.getOwnPropertyDescriptor(M,"checked").set,K=!m.current;if(C!==a&&X){const G=new Event("click",{bubbles:K});f.indeterminate=S(a),X.call(f,S(a)?!1:a),f.dispatchEvent(G)}},[l,C,a,m]);const c=b.useRef(S(a)?!1:a);return e.jsx(Q.input,{type:"checkbox","aria-hidden":!0,defaultChecked:g??c.current,required:_,disabled:t,name:y,value:N,form:o,...j,tabIndex:-1,ref:k,style:{...j.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ge.displayName=ve;function Le(n){return typeof n=="function"}function S(n){return n==="indeterminate"}function _e(n){return S(n)?"indeterminate":n?"checked":"unchecked"}const Y=b.forwardRef(({className:n,...j},u)=>e.jsx(ee,{ref:u,className:le("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),...j,children:e.jsx(be,{className:le("flex items-center justify-center text-current"),children:e.jsx(Te,{className:"h-4 w-4"})})}));Y.displayName=ee.displayName;const rs=()=>{var se,te,re,ie,ae;const n=Se(),j=Fe(),u=Pe(),{data:v}=Re(),{data:m,isLoading:a}=Ee(),[g,_]=b.useState(""),{register:t,control:y,handleSubmit:N,watch:o,setValue:l,formState:{errors:r,isSubmitting:k}}=Ae({resolver:Ie(qe),defaultValues:{currency:"INR",assignment_mode:"open",payment_type:"fixed",required_skills:[],software_preferences:[],deliverables:[],shot_breakdown:[],assigned_to:[]}}),C=o("assignment_mode"),w=(se=v==null?void 0:v.user)==null?void 0:se.id,c=b.useMemo(()=>{if(!m||!w)return[];const s=new Map;return m.forEach(d=>{const x=d.requester._id===w?d.recipient:d.requester,F=x.name||x.email||"Unknown User";s.has(x._id)||s.set(x._id,{id:x._id,name:F,email:x.email||""})}),Array.from(s.values()).sort((d,x)=>d.name.localeCompare(x.name))},[m,w]),{fields:f,append:M,remove:T}=ce({control:y,name:"shot_breakdown"}),{fields:X,append:K,remove:G}=ce({control:y,name:"deliverables"}),ye=async s=>{var d,x,F,q,$,ne;try{const W={...s,required_skills:(d=s.required_skills)!=null&&d.length?(x=s.required_skills[0])==null?void 0:x.split(",").map(B=>B.trim()).filter(Boolean):[],software_preferences:(F=s.software_preferences)!=null&&F.length?(q=s.software_preferences[0])==null?void 0:q.split(",").map(B=>B.trim()).filter(Boolean):[]},J=await j.mutateAsync(W);if(J.job.assignment_mode==="open"&&J.job.bid_deadline)try{await u.mutateAsync(J.job._id),z.success("project created and published successfully!")}catch(B){console.warn("project created but failed to auto-publish:",B),z.success("project created successfully! You can publish it from the job details.")}else z.success("project created successfully!");n(`/jobs/${J.job._id}`)}catch(W){z.error(((ne=($=W.response)==null?void 0:$.data)==null?void 0:ne.error)||"Failed to create job")}};return e.jsxs("div",{className:"container mx-auto px-6 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Create VFX Job"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Post a new VFX project for studios and artists to bid on"})]}),e.jsxs("form",{onSubmit:N(ye),className:"space-y-8",children:[e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(E,{children:"Basic Information"})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"title",children:"Job Title *"}),e.jsx(p,{id:"title",...t("title"),placeholder:"e.g., Sci-Fi Explosion VFX"}),r.title&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.title.message})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"description",children:"Description *"}),e.jsx(H,{id:"description",...t("description"),placeholder:"Detailed description of the VFX work required...",rows:4}),r.description&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.description.message})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"workType",children:"Work Type"}),e.jsxs(D,{value:g,onValueChange:_,children:[e.jsx(V,{children:e.jsx(L,{placeholder:"Select work type"})}),e.jsxs(U,{children:[e.jsx(h,{value:"vfx",children:"VFX"}),e.jsx(h,{value:"animation",children:"Animation"}),e.jsx(h,{value:"motion_graphics",children:"Motion Graphics"}),e.jsx(h,{value:"compositing",children:"Compositing"}),e.jsx(h,{value:"modeling",children:"3D Modeling"})]})]})]})]})]}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(E,{children:"Assignment"})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"assignment_mode",children:"Assignment Mode *"}),e.jsxs(D,{value:C,onValueChange:s=>{l("assignment_mode",s),s==="open"&&l("assigned_to",[])},children:[e.jsx(V,{children:e.jsx(L,{placeholder:"Select assignment mode"})}),e.jsxs(U,{children:[e.jsx(h,{value:"open",children:"Open for Bidding"}),e.jsx(h,{value:"direct",children:"Direct Assignment"})]})]}),r.assignment_mode&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.assignment_mode.message})]}),C==="direct"&&e.jsxs("div",{children:[e.jsx(i,{htmlFor:"assigned_to",children:"Assign to Association Members *"}),a?e.jsxs("div",{className:"flex items-center gap-2 py-2",children:[e.jsx(oe,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading association members..."})]}):c.length===0?e.jsx("div",{className:"text-sm text-muted-foreground py-2",children:"No association members found. You need to have accepted associations to assign jobs directly."}):e.jsxs("div",{className:"space-y-3 border rounded-md p-4 max-h-60 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Y,{id:"select-all",checked:((te=o("assigned_to"))==null?void 0:te.length)===c.length,onCheckedChange:s=>{s?l("assigned_to",c.map(d=>d.id)):l("assigned_to",[])}}),e.jsx(i,{htmlFor:"select-all",className:"text-sm font-medium cursor-pointer",children:"Select All"})]}),e.jsx(me,{}),c.map(s=>{const x=(o("assigned_to")||[]).includes(s.id);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{id:`member-${s.id}`,checked:x,onCheckedChange:F=>{const q=o("assigned_to")||[];F?l("assigned_to",[...q,s.id]):l("assigned_to",q.filter($=>$!==s.id))}}),e.jsxs(i,{htmlFor:`member-${s.id}`,className:"text-sm font-normal cursor-pointer flex-1",children:[s.name," ",s.email&&e.jsxs("span",{className:"text-muted-foreground",children:["(",s.email,")"]})]})]},s.id)})]}),r.assigned_to&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.assigned_to.message}),((re=o("assigned_to"))==null?void 0:re.length)>0&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[(ie=o("assigned_to"))==null?void 0:ie.length," member",((ae=o("assigned_to"))==null?void 0:ae.length)!==1?"s":""," selected"]})]})]})]}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(E,{children:"Budget & Payment"})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"payment_type",children:"Payment Type *"}),e.jsxs(D,{onValueChange:s=>l("payment_type",s),children:[e.jsx(V,{children:e.jsx(L,{placeholder:"Select payment type"})}),e.jsxs(U,{children:[e.jsx(h,{value:"fixed",children:"Fixed Price"}),e.jsx(h,{value:"per_shot",children:"Per Shot"}),e.jsx(h,{value:"per_frame",children:"Per Frame"})]})]}),r.payment_type&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.payment_type.message})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"currency",children:"Currency"}),e.jsxs(D,{defaultValue:"INR",onValueChange:s=>l("currency",s),children:[e.jsx(V,{children:e.jsx(L,{})}),e.jsxs(U,{children:[e.jsx(h,{value:"INR",children:"INR"}),e.jsx(h,{value:"USD",children:"USD"}),e.jsx(h,{value:"EUR",children:"EUR"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"min_budget",children:"Min Budget"}),e.jsx(p,{id:"min_budget",type:"number",...t("min_budget",{valueAsNumber:!0}),placeholder:"0"}),r.min_budget&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.min_budget.message})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"max_budget",children:"Max Budget"}),e.jsx(p,{id:"max_budget",type:"number",...t("max_budget",{valueAsNumber:!0}),placeholder:"Enter maximum budget"}),r.max_budget&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.max_budget.message})]})]})]}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(E,{children:"VFX Specifications"})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"resolution",children:"Resolution"}),e.jsx(p,{id:"resolution",...t("resolution"),placeholder:"e.g., 2K, 4K"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"frame_rate",children:"Frame Rate"}),e.jsx(p,{id:"frame_rate",type:"number",...t("frame_rate",{valueAsNumber:!0}),placeholder:"24"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"total_shots",children:"Total Shots"}),e.jsx(p,{id:"total_shots",type:"number",...t("total_shots",{valueAsNumber:!0}),placeholder:"5"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"total_frames",children:"Total Frames"}),e.jsx(p,{id:"total_frames",type:"number",...t("total_frames",{valueAsNumber:!0}),placeholder:"300"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(i,{children:"Shot Breakdown"}),e.jsxs(I,{type:"button",variant:"outline",size:"sm",onClick:()=>M({name:"",shot_code:"",complexity:"medium"}),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Add Shot"]})]}),e.jsx("div",{className:"space-y-4",children:f.map((s,d)=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Shot Name *"}),e.jsx(p,{...t(`shot_breakdown.${d}.name`),placeholder:"Explosion Main"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Shot Code"}),e.jsx(p,{...t(`shot_breakdown.${d}.shot_code`),placeholder:"EXP_001"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Frame In"}),e.jsx(p,{type:"number",...t(`shot_breakdown.${d}.frame_in`,{valueAsNumber:!0}),placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Frame Out"}),e.jsx(p,{type:"number",...t(`shot_breakdown.${d}.frame_out`,{valueAsNumber:!0}),placeholder:"72"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{children:"Complexity"}),e.jsxs(D,{onValueChange:x=>l(`shot_breakdown.${d}.complexity`,x),defaultValue:"medium",children:[e.jsx(V,{children:e.jsx(L,{})}),e.jsxs(U,{children:[e.jsx(h,{value:"low",children:"Low"}),e.jsx(h,{value:"medium",children:"Medium"}),e.jsx(h,{value:"high",children:"High"})]})]})]}),e.jsx(I,{type:"button",variant:"destructive",size:"sm",onClick:()=>T(d),children:e.jsx(ue,{className:"h-4 w-4"})})]})]})},s.id))})]})]})]}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(E,{children:"Requirements & Deliverables"})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"required_skills",children:"Required Skills *"}),e.jsx(H,{id:"required_skills",...t("required_skills.0"),placeholder:"compositing, particles, roto (comma-separated)",rows:2}),r.required_skills&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.required_skills.message})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"software_preferences",children:"Software Preferences"}),e.jsx(H,{id:"software_preferences",...t("software_preferences.0"),placeholder:"Nuke, Houdini, After Effects (comma-separated)",rows:2})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(i,{children:"Deliverables *"}),e.jsxs(I,{type:"button",variant:"outline",size:"sm",onClick:()=>K(""),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Add Deliverable"]})]}),e.jsx("div",{className:"space-y-2",children:X.map((s,d)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{...t(`deliverables.${d}`),placeholder:"e.g., EXR sequences with Cryptomatte"}),e.jsx(I,{type:"button",variant:"destructive",size:"sm",onClick:()=>G(d),children:e.jsx(ue,{className:"h-4 w-4"})})]},s.id))}),r.deliverables&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.deliverables.message})]})]})]}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(E,{children:"Schedule & Notes"})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[C==="open"&&e.jsxs("div",{children:[e.jsx(i,{htmlFor:"bid_deadline",children:"Bid Deadline *"}),e.jsx(p,{id:"bid_deadline",type:"date",...t("bid_deadline")}),r.bid_deadline&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.bid_deadline.message})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"expected_start_date",children:"Expected Start Date"}),e.jsx(p,{id:"expected_start_date",type:"date",...t("expected_start_date")})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"final_delivery_date",children:"Final Delivery Date *"}),e.jsx(p,{id:"final_delivery_date",type:"date",...t("final_delivery_date")}),r.final_delivery_date&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.final_delivery_date.message})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"notes_for_bidders",children:"Notes for Bidders"}),e.jsx(H,{id:"notes_for_bidders",...t("notes_for_bidders"),placeholder:"Additional information for potential bidders...",rows:3})]})]})]}),e.jsx(me,{}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>n("/jobs"),children:"Cancel"}),e.jsxs(I,{type:"submit",disabled:k,children:[k&&e.jsx(oe,{className:"h-4 w-4 mr-2 animate-spin"}),"Create project"]})]})]})]})};export{rs as default};
