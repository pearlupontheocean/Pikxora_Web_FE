import{c as ee,x as se,a as te,a0 as re,ab as ae,r as ie,j as e,X as le,f as de,u as M}from"./index-CSY5YgiJ.js";import{u as ne,c as ce,b as T,C as oe,t as me}from"./zod-d7-ns2YA.js";import{B as m,C as x,a as u,b as p,c as j}from"./card-dyY2Qvrr.js";import{I as d}from"./input-bM4iH4pw.js";import{T as F}from"./textarea-BOa-INnI.js";import{S as v,a as g,b as f,c as b,d as n}from"./select-CjlLjNwJ.js";import{L as a}from"./label-Bz9P5vOH.js";import{S as C}from"./skeleton-DxyLGv-Z.js";import{j as he}from"./jobs-hMLXsdQf.js";import{P as J}from"./plus-35letP8-.js";import{T as U}from"./trash-2-DWtXyLna.js";import"./index-Q8Z8E6D0.js";import"./Combination-CrH4g3RK.js";import"./types-L2k3iFj2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=ee("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),ke=()=>{const{id:y}=se(),k=te(),E=t=>({draft:["open","cancelled"],open:["under_review","cancelled"],under_review:["awarded","open","cancelled"],awarded:["in_progress","cancelled"],in_progress:["completed","cancelled"],completed:[],cancelled:[]})[t]||[],{data:s,isLoading:A,error:L}=re(y),O=ae(),{register:l,control:N,handleSubmit:$,setValue:w,watch:X,reset:P,formState:{errors:i,isSubmitting:q}}=ne({resolver:me(he)}),S=X("assignment_mode"),z=ce({control:N,name:"status"});console.log("JobEditPage - Render: jobLoading",A,"job?.assignment_mode:",s==null?void 0:s.assignment_mode,"assignmentMode (watched):",S);const{fields:H,append:K,remove:W,replace:V}=T({control:N,name:"shot_breakdown"}),{fields:G,append:Q,remove:Y,replace:I}=T({control:N,name:"deliverables"});ie.useEffect(()=>{var t,r;s&&(P({title:s.title,description:s.description,movie_id:((t=s.movie_id)==null?void 0:t._id)||"",assignment_mode:s.assignment_mode,assigned_to:((r=s.assigned_to)==null?void 0:r._id)||"",payment_type:s.payment_type,currency:s.currency,min_budget:s.min_budget,max_budget:s.max_budget,total_shots:s.total_shots,total_frames:s.total_frames,resolution:s.resolution,frame_rate:s.frame_rate,required_skills:s.required_skills?[s.required_skills.join(", ")]:[""],software_preferences:s.software_preferences?[s.software_preferences.join(", ")]:[""],bid_deadline:s.bid_deadline?new Date(s.bid_deadline).toISOString().slice(0,10):"",expected_start_date:s.expected_start_date?new Date(s.expected_start_date).toISOString().slice(0,10):"",final_delivery_date:s.final_delivery_date?new Date(s.final_delivery_date).toISOString().slice(0,10):"",notes_for_bidders:s.notes_for_bidders,status:s.status}),V(s.shot_breakdown||[]),I(s.deliverables||[]))},[s,P,V,I]);const Z=async t=>{var r,h,B,R;try{const o={...t,required_skills:(r=t.required_skills)!=null&&r[0]?t.required_skills[0].split(",").map(c=>c.trim()).filter(Boolean):[],software_preferences:(h=t.software_preferences)!=null&&h[0]?t.software_preferences[0].split(",").map(c=>c.trim()).filter(Boolean):[]},_={};Object.keys(o).forEach(c=>{const D=o[c];(c==="movie_id"||c==="assigned_to")&&(D===""||D===void 0)||(_[c]=D)}),o.status&&(_.status=o.status),console.log("ðŸ” JobEditPage - Original form data:",t),console.log("ðŸ” JobEditPage - Processed data:",o),console.log("ðŸ” JobEditPage - Final data being sent:",_),console.log("ðŸ” JobEditPage - Status field:",_.status),await O.mutateAsync({id:y,data:_}),M.success("project updated successfully!"),k(`/jobs/${y}`)}catch(o){M.error(((R=(B=o.response)==null?void 0:B.data)==null?void 0:R.error)||"Failed to update job")}};return A?e.jsx("div",{className:"container mx-auto px-6 py-8 max-w-4xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(C,{className:"h-8 w-3/4"}),e.jsx(C,{className:"h-32 w-full"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(C,{className:"h-48 w-full"}),e.jsx(C,{className:"h-48 w-full"})]})]})}):L||!s?e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"project not found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The job you're trying to edit doesn't exist or you don't have permission."}),e.jsx(m,{onClick:()=>k("/jobs"),children:"Back to projects"})]})}):e.jsxs("div",{className:"container mx-auto px-6 py-8 max-w-4xl",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Edit project"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Update your job posting details"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(m,{variant:"outline",onClick:()=>k(`/jobs/${y}`),children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs(m,{onClick:$(Z),disabled:q,children:[q&&e.jsx(de,{className:"h-4 w-4 mr-2 animate-spin"}),e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})]})}),e.jsxs("form",{className:"space-y-8",children:[e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{children:"Basic Information"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"title",children:"project Title *"}),e.jsx(d,{id:"title",...l("title"),placeholder:"e.g., Sci-Fi Explosion VFX"}),i.title&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:i.title.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"description",children:"Description *"}),e.jsx(F,{id:"description",...l("description"),placeholder:"Detailed description of the VFX work required...",rows:4}),i.description&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:i.description.message})]})]})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{children:"Assignment & Status"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"assignment_mode",children:"Assignment Mode *"}),e.jsxs(v,{value:S,onValueChange:t=>w("assignment_mode",t),children:[e.jsx(g,{children:e.jsx(f,{placeholder:"Select assignment mode"})}),e.jsxs(b,{children:[e.jsx(n,{value:"open",children:"Open for Bidding"}),e.jsx(n,{value:"direct",children:"Direct Assignment"})]})]}),i.assignment_mode&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:i.assignment_mode.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"status",children:"project Status *"}),e.jsx(oe,{name:"status",control:N,defaultValue:(s==null?void 0:s.status)||"draft",render:({field:t})=>(console.log("ðŸ” Status Controller field value:",t.value),e.jsxs(v,{value:t.value,onValueChange:r=>{console.log("ðŸ” Status onChange called with:",r),t.onChange(r)},children:[e.jsx(g,{children:e.jsx(f,{})}),e.jsxs(b,{children:[E(t.value||(s==null?void 0:s.status)||"draft").map(r=>e.jsxs(n,{value:r,children:[r.replace("_"," ").replace(/\b\w/g,h=>h.toUpperCase()),r==="open"&&t.value==="draft"&&" (Publish project)"]},r)),!E(t.value||(s==null?void 0:s.status)||"draft").includes(t.value||(s==null?void 0:s.status)||"draft")&&e.jsx(n,{value:t.value||(s==null?void 0:s.status)||"draft",children:(t.value||(s==null?void 0:s.status)||"draft").replace("_"," ").replace(/\b\w/g,r=>r.toUpperCase())})]})]}))}),z==="draft"&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:'Change to "Open" to publish this job for bidding'})]})]}),S==="direct"&&e.jsxs("div",{children:[e.jsx(a,{htmlFor:"assigned_to",children:"Assign to User ID *"}),e.jsx(d,{id:"assigned_to",...l("assigned_to"),placeholder:"Enter user ID to assign directly"}),i.assigned_to&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:i.assigned_to.message})]})]})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{children:"Budget & Payment"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"payment_type",children:"Payment Type *"}),e.jsxs(v,{onValueChange:t=>w("payment_type",t),children:[e.jsx(g,{children:e.jsx(f,{placeholder:"Select payment type"})}),e.jsxs(b,{children:[e.jsx(n,{value:"fixed",children:"Fixed Price"}),e.jsx(n,{value:"per_shot",children:"Per Shot"}),e.jsx(n,{value:"per_frame",children:"Per Frame"})]})]}),i.payment_type&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:i.payment_type.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"currency",children:"Currency"}),e.jsxs(v,{defaultValue:"INR",onValueChange:t=>w("currency",t),children:[e.jsx(g,{children:e.jsx(f,{})}),e.jsxs(b,{children:[e.jsx(n,{value:"INR",children:"INR"}),e.jsx(n,{value:"USD",children:"USD"}),e.jsx(n,{value:"EUR",children:"EUR"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"min_budget",children:"Min Budget"}),e.jsx(d,{id:"min_budget",type:"number",...l("min_budget",{valueAsNumber:!0}),placeholder:"0"}),i.min_budget&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:i.min_budget.message})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"max_budget",children:"Max Budget"}),e.jsx(d,{id:"max_budget",type:"number",...l("max_budget",{valueAsNumber:!0}),placeholder:"Enter maximum budget"}),i.max_budget&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:i.max_budget.message})]})]})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{children:"VFX Specifications"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"resolution",children:"Resolution"}),e.jsx(d,{id:"resolution",...l("resolution"),placeholder:"e.g., 2K, 4K"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"frame_rate",children:"Frame Rate"}),e.jsx(d,{id:"frame_rate",type:"number",...l("frame_rate",{valueAsNumber:!0}),placeholder:"24"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"total_shots",children:"Total Shots"}),e.jsx(d,{id:"total_shots",type:"number",...l("total_shots",{valueAsNumber:!0}),placeholder:"5"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"total_frames",children:"Total Frames"}),e.jsx(d,{id:"total_frames",type:"number",...l("total_frames",{valueAsNumber:!0}),placeholder:"300"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(a,{children:"Shot Breakdown"}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:()=>K({name:"",shot_code:"",complexity:"medium"}),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add Shot"]})]}),e.jsx("div",{className:"space-y-4",children:H.map((t,r)=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(a,{children:"Shot Name *"}),e.jsx(d,{...l(`shot_breakdown.${r}.name`),placeholder:"Explosion Main"})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Shot Code"}),e.jsx(d,{...l(`shot_breakdown.${r}.shot_code`),placeholder:"EXP_001"})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Frame In"}),e.jsx(d,{type:"number",...l(`shot_breakdown.${r}.frame_in`,{valueAsNumber:!0}),placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Frame Out"}),e.jsx(d,{type:"number",...l(`shot_breakdown.${r}.frame_out`,{valueAsNumber:!0}),placeholder:"72"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(a,{children:"Complexity"}),e.jsxs(v,{onValueChange:h=>w(`shot_breakdown.${r}.complexity`,h),defaultValue:"medium",children:[e.jsx(g,{children:e.jsx(f,{})}),e.jsxs(b,{children:[e.jsx(n,{value:"low",children:"Low"}),e.jsx(n,{value:"medium",children:"Medium"}),e.jsx(n,{value:"high",children:"High"})]})]})]}),e.jsx(m,{type:"button",variant:"destructive",size:"sm",onClick:()=>W(r),children:e.jsx(U,{className:"h-4 w-4"})})]})]})},t.id))})]})]})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{children:"Requirements & Deliverables"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"required_skills",children:"Required Skills *"}),e.jsx(F,{id:"required_skills",...l("required_skills.0"),placeholder:"compositing, particles, roto (comma-separated)",rows:2}),i.required_skills&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:i.required_skills.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"software_preferences",children:"Software Preferences"}),e.jsx(F,{id:"software_preferences",...l("software_preferences.0"),placeholder:"Nuke, Houdini, After Effects (comma-separated)",rows:2})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(a,{children:"Deliverables *"}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:()=>Q(""),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add Deliverable"]})]}),e.jsx("div",{className:"space-y-2",children:G.map((t,r)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{...l(`deliverables.${r}`),placeholder:"e.g., EXR sequences with Cryptomatte"}),e.jsx(m,{type:"button",variant:"destructive",size:"sm",onClick:()=>Y(r),children:e.jsx(U,{className:"h-4 w-4"})})]},t.id))}),i.deliverables&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:i.deliverables.message})]})]})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{children:"Schedule & Notes"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(S==="open"||(s==null?void 0:s.assignment_mode)==="open")&&e.jsxs("div",{children:[e.jsx(a,{htmlFor:"bid_deadline",children:"Bid Deadline *"}),e.jsx(d,{id:"bid_deadline",type:"date",...l("bid_deadline")}),i.bid_deadline&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:i.bid_deadline.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"expected_start_date",children:"Expected Start Date"}),e.jsx(d,{id:"expected_start_date",type:"date",...l("expected_start_date")})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"final_delivery_date",children:"Final Delivery Date *"}),e.jsx(d,{id:"final_delivery_date",type:"date",...l("final_delivery_date")}),i.final_delivery_date&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:i.final_delivery_date.message})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"notes_for_bidders",children:"Notes for Bidders"}),e.jsx(F,{id:"notes_for_bidders",...l("notes_for_bidders"),placeholder:"Additional information for potential bidders...",rows:3})]})]})]})]})]})};export{ke as default};
